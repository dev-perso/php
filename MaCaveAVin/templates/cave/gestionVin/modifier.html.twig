{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/modifier.css') }}">
{% endblock %}

{% block body %}
    <div class="container mb-5">
        <h1 class="mt-3 mb-3">Modifier le vin : {{ vin.appellation }}</h1>
        {{ form_start(form) }}
            <div class="row">
                <div class="offset-lg-3 col-lg-6 p-3" style="border : 1px solid lightgrey; border-radius : 5px; background-color : #eeeeee">
                    <div class="row">
                        <div class="col-sm-12">
                            <label for="editAppellation">Appellation</label>
                            <input type="text" name="editAppellation" id="editAppellation" class="form-control" required="required" value="{{ vin.appellation }}" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <label for="editDomain">Domaine</label>
                            <input type="text" name="editDomain" id="editDomain" class="form-control" required="required" value="{{ vin.getEntityDomaine().domaine }}" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <label for="regionSelect">Région</label>
                            <select name="editRegion" id="regionSelect" class="form-control">
                                {%  for region in regions %}
                                    {% if region.idregion == vin.getEntityRegion().idregion %}
                                        <option value="{{ region.idregion }}" selected="selected">{{ region.region }}</option>
                                        <option value="{{ region.idregion }}">{{ region.region }}</option>
                                    {% else %}
                                        <option value="{{ region.idregion }}">{{ region.region }}</option>
                                    {% endif %}
                                {%  endfor %}
                            </select>
                        </div>
                        <div class="col-sm-6">
                            <label form="colorSelect">Couleur</label>
                            <select name="editColor" id="colorSelect" class="form-control">
                                {%  for couleur in couleurs %}
                                    {% if couleur.idcouleur == vin.getEntityCouleur().idcouleur %}
                                        <option value="{{ couleur.idcouleur }}" selected="selected">{{ couleur.couleur }}</option>
                                        <option value="{{ couleur.idcouleur }}">{{ couleur.couleur }}</option>
                                    {% else %}
                                        <option value="{{ couleur.idcouleur }}">{{ couleur.couleur }}</option>
                                    {% endif %}
                                {%  endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <label for="editYear">Année</label>
                            <select name="editYear" id="editYear" class="form-control">
                                {%  for year in years %}
                                    {% if year == vin.annee %}
                                        <option value="{{ year }}" selected="selected">{{ year }}</option>
                                        <option value="{{ year }}">{{ year }}</option>
                                    {% else %}
                                        <option value="{{ year }}">{{ year }}</option>
                                    {% endif %}
                                {%  endfor %}
                            </select>
                        </div>
                        <div class="col-sm-6">
                            {{ form_row(form.quantite) }}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="input-group">
                                {{ form_label(form.prix) }}
                                <div class="input-group mb-3">
                                    {{ form_widget(form.prix, { 'attr': {'aria-label' : 'Montant en euro'}} ) }}
                                    <div class="input-group-append">
                                        <span class="input-group-text">€</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            {{ form_row(form.note) }}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            {{ form_row(form.description) }}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 text-right">
                            <button class="btn btn-light"><i class="fa fa-pencil"></i> {{ button|default('Modifier') }}</button>
                        </div>
                    </div>
                </div>
                {{ form_rest(form) }}
            </div>
        {{ form_end(form) }}
    </div>
{% endblock %}

{% block javascripts %}
    <script type="text/javascript">
        // Restricts input for the given textbox to the given inputFilter.
        function setInputFilter(textbox, inputFilter) {
            ["input", "keydown", "keyup", "mousedown", "mouseup", "select", "contextmenu", "drop"].forEach(function(event) {
                textbox.addEventListener(event, function() {
                    if (inputFilter(this.value)) {
                        this.oldValue = this.value;
                        this.oldSelectionStart = this.selectionStart;
                        this.oldSelectionEnd = this.selectionEnd;
                    } else if (this.hasOwnProperty("oldValue")) {
                        this.value = this.oldValue;
                        this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
                    } else {
                        this.value = "";
                    }
                });
            });
        }

        setInputFilter(document.getElementById("cave_prix"), function(value) {
            return /^-?\d*[.,]?\d*$/.test(value); });
    </script>
{% endblock %}